<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug API Response</title>
</head>
<body>
    <h1>Debug API Response</h1>
    <input type="tel" id="phone" placeholder="Enter phone number">
    <button id="send-otp">Send OTP</button>
    <div id="result"></div>

    <script>
        // Simple debug script to see the actual response structure
        document.getElementById('send-otp').addEventListener('click', async () => {
            const phone = document.getElementById('phone').value;
            const resultDiv = document.getElementById('result');
            
            try {
                // First get JWT token
                const tokenResponse = await fetch('/api/auth/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': 'my_secret_api_key_12345'
                    },
                    body: JSON.stringify({
                        client_id: 'web_client',
                        client_secret: 'web_client_secret'
                    })
                });
                
                const tokenData = await tokenResponse.json();
                console.log('Token response:', tokenData);
                
                if (!tokenResponse.ok) {
                    resultDiv.innerHTML = `<pre>Error getting token: ${JSON.stringify(tokenData, null, 2)}</pre>`;
                    return;
                }
                
                // Send OTP
                const otpResponse = await fetch('/api/send-missed-call', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${tokenData.token}`
                    },
                    body: JSON.stringify({
                        mobile: phone,
                        pattern_id: 950
                    })
                });
                
                const otpData = await otpResponse.json();
                console.log('OTP response:', otpData);
                
                resultDiv.innerHTML = `
                    <h2>Token Response</h2>
                    <pre>${JSON.stringify(tokenData, null, 2)}</pre>
                    <h2>OTP Response</h2>
                    <pre>${JSON.stringify(otpData, null, 2)}</pre>
                    <h2>UUID Extraction</h2>
                    <p>UUID from response.data.uuid: ${otpData.data?.uuid || 'Not found'}</p>
                    <p>UUID from response.data.id: ${otpData.data?.id || 'Not found'}</p>
                    <p>Full response keys: ${Object.keys(otpData.data || {})}</p>
                `;
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `<pre>Error: ${error.message}</pre>`;
            }
        });
    </script>
</body>
</html>